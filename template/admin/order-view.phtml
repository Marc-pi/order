<?php
$this->css(array(
    $this->assetModule('css/admin.css'),
    $this->assetModule('script/system-ui.css', 'system'),
));
$this->jQuery();
$this->backbone();
?>
<div id="js-order" class="order-view clearfix">
    <div class="order-form" data-id="<?php echo $this->escape($order['id']); ?>"
         data-order="<?php echo $this->escape($order['url_update_order']); ?>"
         data-payment="<?php echo $this->escape($order['url_update_payment']); ?>"
         data-delivery="<?php echo $this->escape($order['url_update_delivery']); ?>"
         data-canPay="<?php echo $this->escape($order['url_update_canPay']); ?>"
         data-note="<?php echo $this->escape($order['url_update_note']); ?>">

        <div class="page-header">
            <ul class="list-inline clearfix">
                <li class="pull-left">
                    <h1><?php echo sprintf(__('Order %s details'), $order['code']); ?></h1>
                </li>
                <li class="pull-right">
                    <a class="btn btn-success" title="<?php _e('Edit'); ?>"
                       href="<?php echo $this->url('', array(
                           'controller' => 'order',
                           'action' => 'edit',
                           'id' => $order['id']
                       )); ?>"><i class="fa fa-edit"></i> <?php _e('Edit'); ?>
                    </a>
                </li>
            </ul>
        </div>

        <?php if ($order['gateway'] == 'Offline') { ?>
            <div class="alert alert-danger">
                <ul class="list-inline">
                    <li class="order-main-icon"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i></li>
                    <li><?php _e('This order have offline payment'); ?></li>
                </ul>
            </div>
        <?php } ?>

        <div class="alert alert-info">
            <ul class="list-inline">
                <li class="order-main-icon"><i class="fa fa-user" aria-hidden="true"></i></li>
                <?php if (!empty($order['first_name']) && !empty($order['last_name'])) { ?>
                    <li><strong><?php _e('Name'); ?></strong> :
                        <span><?php echo $this->escape($order['first_name']); ?> <?php echo $this->escape($order['last_name']); ?></span>
                    </li>
                <?php } ?>
                <?php if (!empty($order['email'])) { ?>
                    <li><strong><?php _e('Email'); ?></strong> :
                        <span><?php echo $this->escape($order['email']); ?></span></li>
                <?php } ?>
                <?php if (!empty($order['phone'])) { ?>
                    <li><strong><?php _e('Phone'); ?></strong> :
                        <span><?php echo $this->escape($order['phone']); ?></span></li>
                <?php } ?>
                <?php if (!empty($order['mobile'])) { ?>
                    <li><strong><?php _e('Mobile'); ?></strong> :
                        <span><?php echo $this->escape($order['mobile']); ?></span></li>
                <?php } ?>
                <?php if ($order['total_price'] > 0) { ?>
                    <li><strong><?php _e('Total price'); ?></strong> :
                        <span><?php echo $this->escape($order['total_price_view']); ?></span></li>
                <?php } ?>
            </ul>
        </div>

        <?php if (!empty($order['invoices'])) { ?>
            <?php if ($order['paidInvoice'] == $order['totalInvoice']) {
                $classAlert = 'alert-success';
            } elseif ($order['unPaidInvoice'] == $order['totalInvoice']) {
                $classAlert = 'alert-danger';
            } else {
                $classAlert = 'alert-warning';
            } ?>
            <div class="alert <?php echo $classAlert; ?>">
                <ul class="list-inline clearfix">
                    <li class="order-main-icon"><i class="fa fa-calculator" aria-hidden="true"></i></li>
                    <li><strong><?php _e('Pay invoice status'); ?></strong> :</li>
                    <li><?php echo $this->escape($order['statusInvoice']); ?></li>
                </ul>
            </div>
        <?php } ?>

        <?php if ($config['score_active']) { ?>
            <?php $score = Pi::api('invoice', 'order')->getInvoiceScore($order['uid']); ?>
            <div class="alert alert-info">
                <ul class="list-inline clearfix">
                    <li class="order-main-icon"><i class="fa fa-star-o" aria-hidden="true"></i></li>
                    <li><strong><?php _e('User score'); ?></strong> :</li>
                    <li><?php echo sprintf(__('Type : %s - Amount : %s'), $score['type_view'], $score['amount_view']); ?></li>
                </ul>
            </div>
        <?php } ?>

        <?php if ($config['credit_active']) { ?>
            <div class="alert alert-info">
                <ul class="list-inline clearfix">
                    <li class="order-main-icon"><i class="fa fa-money" aria-hidden="true"></i></li>
                    <li><strong><?php _e('Credit'); ?></strong> :</li>
                    <li><?php echo $this->escape($order['credit']['amount_view']); ?></li>
                    <li>( <?php echo $this->escape($order['credit']['time_update_view']); ?> )</li>
                    <li class="pull-right">
                        <a class="btn btn-info btn-xs"
                           href="<?php echo $this->url('', array('controller' => 'credit', 'action' => 'update', 'uid' => $order['uid'])); ?>"
                           title="<?php _e('Update credit'); ?>" target="_blank"><i
                                    class="fa fa-plus"></i> <?php _e('Update credit'); ?></a>
                        <a class="btn btn-info btn-xs"
                           href="<?php echo $this->url('', array('controller' => 'credit', 'action' => 'history', 'uid' => $order['uid'])); ?>"
                           title="<?php _e('History'); ?>" target="_blank"><i
                                    class="fa fa-plus"></i> <?php _e('History'); ?></a>
                    </li>
                </ul>
            </div>
        <?php } ?>

        <div class="panel-group" id="accordion">

            <!-- accordion -->
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="headingInformation">
                    <h4 class="panel-title">
                        <a class="accordion-toggle" data-toggle="collapse" href="#collapseInformation" aria-expanded="false" aria-controls="collapseInformation">
                            <i class="fa fa-plus"></i> <?php _e('Main information of order'); ?>
                        </a>
                    </h4>
                </div>
                <div id="collapseInformation" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingInformation">
                    <div class="panel-body">
                        <div class="clearfix">
                            <div class="col-md-6">
                                <?php if (!empty($order['first_name']) && !empty($order['last_name'])) { ?>
                                    <p><strong><?php _e('Name'); ?></strong> :
                                        <span><?php echo $this->escape($order['first_name']); ?> <?php echo $this->escape($order['last_name']); ?></span>
                                    </p>
                                <?php } ?>
                                <?php if (!empty($order['id_number'])) { ?>
                                    <p><strong><?php _e('ID number'); ?></strong> :
                                        <span><?php echo $this->escape($order['id_number']); ?></span></p>
                                <?php } ?>
                                <?php if (!empty($order['address1'])) { ?>
                                    <p><strong><?php _e('Delivery address'); ?></strong> :
                                        <span><?php echo $this->escape($order['address1']); ?></span></p>
                                <?php } ?>
                                <?php if (!empty($order['address2'])) { ?>
                                    <p><strong><?php _e('Invoicing Address'); ?></strong> :
                                        <span><?php echo $this->escape($order['address2']); ?></span></p>
                                <?php } ?>
                                <?php if (!empty($order['city'])) { ?>
                                    <p><strong><?php _e('City'); ?></strong> :
                                        <span><?php echo $this->escape($order['city']); ?></span></p>
                                <?php } ?>
                                <?php if (!empty($order['state'])) { ?>
                                    <p><strong><?php _e('State'); ?></strong> :
                                        <span><?php echo $this->escape($order['state']); ?></span></p>
                                <?php } ?>
                                <?php if (!empty($order['country'])) { ?>
                                    <p><strong><?php _e('Country'); ?></strong> :
                                        <span><?php echo $this->escape($order['country']); ?></span></p>
                                <?php } ?>
                                <?php if (!empty($order['zip_code'])) { ?>
                                    <p><strong><?php _e('Zip code'); ?></strong> :
                                        <span><?php echo $this->escape($order['zip_code']); ?></span></p>
                                <?php } ?>
                                <?php if (!empty($order['email'])) { ?>
                                    <p><strong><?php _e('Email'); ?></strong> :
                                        <span><?php echo $this->escape($order['email']); ?></span></p>
                                <?php } ?>
                                <?php if (!empty($order['phone'])) { ?>
                                    <p><strong><?php _e('Phone'); ?></strong> :
                                        <span><?php echo $this->escape($order['phone']); ?></span></p>
                                <?php } ?>
                                <?php if (!empty($order['mobile'])) { ?>
                                    <p><strong><?php _e('Mobile'); ?></strong> :
                                        <span><?php echo $this->escape($order['mobile']); ?></span></p>
                                <?php } ?>
                                <?php if (!empty($order['company'])) { ?>
                                    <p><strong><?php _e('Company'); ?></strong> :
                                        <span><?php echo $this->escape($order['company']); ?></span></p>
                                <?php } ?>
                                <?php if (!empty($order['company_id'])) { ?>
                                    <p><strong><?php _e('Company ID'); ?></strong> :
                                        <span><?php echo $this->escape($order['company_id']); ?></span></p>
                                <?php } ?>
                                <?php if (!empty($order['company_vat'])) { ?>
                                    <p><strong><?php _e('Company VAT'); ?></strong> :
                                        <span><?php echo $this->escape($order['company_vat']); ?></span></p>
                                <?php } ?>
                            </div>
                            <div class="col-md-6">
                                <p><strong><?php _e('Order status'); ?></strong> :
                                    <span><?php echo $this->escape($order['orderTitle']); ?> </span></p>

                                <p><strong><?php _e('Payment status'); ?></strong> :
                                    <span><?php echo $this->escape($order['paymentTitle']); ?> </span></p>

                                <p><strong><?php _e('Delivery status'); ?></strong> :
                                    <span><?php echo $this->escape($order['deliveryTitle']); ?> </span></p>

                                <p><strong><?php _e('Time create'); ?></strong> :
                                    <span><?php echo $this->escape($order['time_create_view']); ?> </span></p>

                                <p><strong><?php _e('Time payment'); ?></strong> :
                                    <span><?php echo $this->escape($order['time_payment_view']); ?> </span></p>

                                <p><strong><?php _e('Time delivery'); ?></strong> :
                                    <span><?php echo $this->escape($order['time_delivery_view']); ?> </span></p>

                                <p><strong><?php _e('Time finish'); ?></strong> :
                                    <span><?php echo $this->escape($order['time_finish_view']); ?> </span></p>

                                <p><strong><?php _e('Time start'); ?></strong> :
                                    <span><?php echo $this->escape($order['time_start_view']); ?> </span></p>

                                <p><strong><?php _e('Time end'); ?></strong> :
                                    <span><?php echo $this->escape($order['time_end_view']); ?> </span></p>

                                <p><strong><?php _e('Gateway'); ?></strong> :
                                    <span><?php echo $this->escape($order['gateway']); ?> </span></p>
                                <?php if ($order['product_price'] > 0) { ?>
                                    <p><strong><?php _e('Product price'); ?></strong> :
                                        <span><?php echo $this->escape($order['product_price_view']); ?></span></p>
                                <?php } ?>
                                <?php if ($order['shipping_price'] > 0) { ?>
                                    <p><strong><?php _e('Shipping price'); ?></strong> :
                                        <span><?php echo $this->escape($order['shipping_price_view']); ?></span></p>
                                <?php } ?>
                                <?php if ($order['packing_price'] > 0) { ?>
                                    <p><strong><?php _e('Packing price'); ?></strong> :
                                        <span><?php echo $this->escape($order['packing_price_view']); ?></span></p>
                                <?php } ?>
                                <?php if ($order['vat_price'] > 0) { ?>
                                    <p><strong><?php _e('Vat price'); ?></strong> :
                                        <span><?php echo $this->escape($order['vat_price_view']); ?></span></p>
                                <?php } ?>
                                <?php if ($order['total_price'] > 0) { ?>
                                    <p><strong><?php _e('Total price'); ?></strong> :
                                        <span><?php echo $this->escape($order['total_price_view']); ?></span></p>
                                <?php } ?>
                                <?php if ($order['paid_price'] > 0) { ?>
                                    <p><strong><?php _e('Paid price'); ?></strong> :
                                        <span><?php echo $this->escape($order['paid_price_view']); ?></span></p>
                                <?php } ?>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- accordion -->
            <div class="panel panel-success">
                <div class="panel-heading" role="tab" id="headingProducts">
                    <h4 class="panel-title">
                        <a class="accordion-toggle" data-toggle="collapse" href="#collapseProducts" aria-expanded="false" aria-controls="collapseProducts">
                            <i class="fa fa-plus"></i> <?php _e('This order products or services list'); ?>
                        </a>
                    </h4>
                </div>
                <div id="collapseProducts" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingProducts">
                    <div class="panel-body">
                        <table class="table table-striped table-bordered table-condensed">
                            <tr>
                                <th><?php _e('Product'); ?></th>
                                <th><?php _e('Number'); ?></th>
                                <th><?php _e('Price'); ?></th>
                                <th><?php _e('Shipping'); ?></th>
                                <th><?php _e('Packing'); ?></th>
                                <th><?php _e('Vat'); ?></th>
                                <th><?php _e('Total'); ?></th>
                                <?php if (in_array($order['module_name'], array('shop'))) { ?>
                                    <th><?php _e('Action'); ?></th>
                                <?php } ?>
                            </tr>
                            <?php foreach ($order['products'] as $product) { ?>
                                <?php if ($product['status'] == 1) { ?>
                                    <tr>
                                        <td>
                                            <div class="productItem">
                                                <?php if (isset($product['details']['productUrl']) && !empty($product['details']['productUrl'])) { ?>
                                                    <a title="<?php echo $this->escape($product['details']['title']); ?>"
                                                       href="<?php echo $this->escape($product['details']['productUrl']); ?>">
                                                        <?php if (isset($product['details']['thumbUrl']) && !empty($product['details']['thumbUrl'])) { ?>
                                                            <img width="32" height="32"
                                                                 src="<?php echo $this->escape($product['details']['thumbUrl']); ?>"
                                                                 alt="<?php echo $this->escape($product['details']['title']); ?>">
                                                        <?php } ?>
                                                        <?php echo $this->escape($product['details']['title']); ?>
                                                    </a>
                                                <?php } else { ?>
                                                    <?php echo $this->escape($product['details']['title']); ?>
                                                <?php } ?>
                                            </div>
                                            <?php if (isset($product['extra']['product']) && !empty($product['extra']['product'])) { ?>
                                                <?php foreach ($product['extra']['product'] as $extraProduct) { ?>
                                                    <div class="productItem">
                                                        <span><?php echo $this->escape($extraProduct['title']); ?></span> :
                                                        <strong><?php echo $this->escape($extraProduct['value']); ?></strong>
                                                    </div>
                                                <?php } ?>
                                            <?php } ?>
                                        </td>
                                        <td><?php echo _number($this->escape($product['number'])); ?></td>
                                        <td>
                                            <?php if ($order['type_payment'] == 'installment') { ?>
                                                <?php echo Pi::api('api', 'order')->viewPrice($this->escape($product['extra']['installment_new_price'])); ?>
                                                ( <?php echo Pi::api('api', 'order')->viewPrice($this->escape($product['extra']['installment_main_price'])); ?> )
                                            <?php } else { ?>
                                                <?php echo Pi::api('api', 'order')->viewPrice($this->escape($product['product_price'])); ?>
                                            <?php } ?>
                                        </td>
                                        <td><?php echo Pi::api('api', 'order')->viewPrice($this->escape($product['shipping_price'])); ?></td>
                                        <td><?php echo Pi::api('api', 'order')->viewPrice($this->escape($product['packing_price'])); ?></td>
                                        <td><?php echo Pi::api('api', 'order')->viewPrice($this->escape($product['vat_price'])); ?></td>
                                        <td>
                                            <?php if ($order['type_payment'] == 'installment') { ?>
                                                <?php echo Pi::api('api', 'order')->viewPrice($this->escape($product['extra']['installment_new_total'])); ?>
                                                ( <?php echo Pi::api('api', 'order')->viewPrice($this->escape($product['extra']['installment_main_total'])); ?> )
                                            <?php } else { ?>
                                                <?php echo Pi::api('api', 'order')->viewPrice($this->escape($product['total_price'])); ?>
                                            <?php } ?>
                                        </td>
                                        <?php if (in_array($order['module_name'], array('shop'))) { ?>
                                            <td>
                                                <a class="btn btn-primary btn-xs" title="<?php _e('Edit'); ?>"
                                                   href="<?php echo $this->url('', array('controller' => 'order', 'action' => 'productEdit', 'order' => $order['id'], 'product' => $product['id'])); ?>">
                                                    <i class="fa fa-pencil"></i> <?php _e('Edit'); ?></a>
                                                <a class="btn btn-danger btn-xs" title="<?php _e('Delete'); ?>"
                                                   href="<?php echo $this->url('', array('controller' => 'order', 'action' => 'productDelete', 'order' => $order['id'], 'product' => $product['id'])); ?>">
                                                    <i class="fa fa-trash-o"></i> <?php _e('Delete'); ?></a>
                                            </td>
                                        <?php } ?>
                                    </tr>
                                <?php } ?>
                            <?php } ?>
                        </table>
                        <?php if (in_array($order['module_name'], array('shop'))) { ?>
                            <hr />
                            <ul class="list-inline clearfix">
                                <li class="pull-left"><?php _e('You can add new product / service to this order'); ?></li>
                                <li class="pull-right">
                                    <a class="btn btn-success" title="<?php _e('Add product / service'); ?>" href="<?php echo $this->url('', array(
                                        'controller' => 'order',
                                        'action' => 'productAdd',
                                        'order' => $order['id']
                                    )); ?>">
                                        <i class="fa fa-plus"></i> <?php _e('Add product / service'); ?>
                                    </a>
                                </li>
                            </ul>
                        <?php } ?>
                    </div>
                </div>
            </div>

            <!-- accordion -->
            <div class="panel panel-success">
                <div class="panel-heading" role="tab" id="headingInvoice">
                    <h4 class="panel-title">
                        <a class="accordion-toggle" data-toggle="collapse" href="#collapseInvoice" aria-expanded="false" aria-controls="collapseInvoice">
                            <i class="fa fa-plus"></i> <?php _e('This order invoices list'); ?>
                        </a>
                    </h4>
                </div>
                <div id="collapseInvoice" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingInvoice">
                    <div class="panel-body">
                        <?php if (!empty($order['invoices'])) { ?>
                            <table class="table table-striped table-bordered table-condensed">
                                <tr>
                                    <th><?php _e('System ID'); ?></th>
                                    <th><?php _e('Bank ID'); ?></th>
                                    <th><?php _e('Price'); ?></th>
                                    <th><?php _e('Time Create'); ?></th>
                                    <th><?php _e('Due date'); ?></th>
                                    <th><?php _e('Time pay'); ?></th>
                                    <th><?php _e('Gateway'); ?></th>
                                    <th><?php _e('Action'); ?></th>
                                </tr>
                                <?php foreach ($order['invoices'] as $invoice) { ?>
                                    <?php
                                    if ($invoice['status'] == 1) {
                                        $labelIdClass = 'label-success';
                                    } elseif ($invoice['status'] == 2) {
                                        $labelIdClass = 'label-warning';
                                    } elseif ($invoice['status'] == 0) {
                                        $labelIdClass = 'label-danger';
                                    }
                                    // Set row class
                                    $rowClass = '';
                                    if ($invoice['status'] == 1) {
                                        $rowClass = ' class="success"';
                                    } elseif ($invoice['time_duedate'] < strtotime("-1 day")) {
                                        $rowClass = ' class="danger"';
                                    } elseif ($invoice['time_duedate'] < strtotime("+1 day")) {
                                        $rowClass = ' class="warning"';
                                    }
                                    ?>
                                    <tr<?php echo $rowClass; ?>>
                                        <td><span class="label <?php echo $labelIdClass; ?>"><?php echo $this->escape($invoice['code']); ?></span></td>
                                        <td><?php echo $this->escape($invoice['random_id']); ?></td>
                                        <td><?php echo $this->escape($invoice['total_price_view']); ?></td>
                                        <td><?php echo $this->escape($invoice['time_create_view']); ?></td>
                                        <td><?php echo $this->escape($invoice['time_duedate_view']); ?></td>
                                        <td><?php echo $this->escape($invoice['time_payment_view']); ?></td>
                                        <td><?php echo $this->escape($invoice['gateway']); ?></td>
                                        <td>
                                            <a class="btn btn-primary btn-xs" title="<?php _e('View'); ?>"
                                               href="<?php echo $this->url('', array('controller' => 'invoice', 'action' => 'view', 'id' => $invoice['id'])); ?>">
                                                <i class="fa fa-eye"></i> <?php _e('View'); ?></a>
                                            <a class="btn btn-primary btn-xs" title="<?php _e('Print'); ?>"
                                               href="<?php echo $this->url('', array('controller' => 'invoice', 'action' => 'print', 'id' => $invoice['id'])); ?>">
                                                <i class="fa fa-print"></i> <?php _e('Print'); ?></a>
                                            <a class="btn btn-primary btn-xs" title="<?php _e('Edit'); ?>"
                                               href="<?php echo $this->url('', array('controller' => 'invoice', 'action' => 'edit', 'id' => $invoice['id'])); ?>">
                                                <i class="fa fa-pencil"></i> <?php _e('Edit'); ?></a>
                                        </td>
                                    </tr>
                                <?php } ?>
                            </table>
                            <ul class="list-inline clearfix">
                                <li class="label label-success"><?php _e('Paid'); ?></li>
                                <li class="label label-warning"><?php _e('Unpaid'); ?></li>
                                <li class="label label-danger"><?php _e('Canceled'); ?></li>
                            </ul>
                            <hr />
                            <ul class="list-inline clearfix">
                                <li class="pull-left"><?php _e('Add extra invoice to this order'); ?></li>
                                <li class="pull-right">
                                    <a class="btn btn-success"
                                       href="<?php echo $this->url('', array('controller' => 'invoice', 'action' => 'add', 'order' => $order['id'])); ?>"
                                       title="<?php _e('New invoice'); ?>"><i
                                                class="fa fa-plus"></i> <?php _e('New invoice'); ?></a>
                                </li>
                            </ul>
                        <?php } else { ?>
                            <div class="well">
                                <h4><?php _e('Add extra invoice to this order'); ?></h4>
                                <p><?php _e('If you want your user pay new price for this order, you can add new invoice for him by new price, use below button to add new invoice'); ?></p>
                                <p><a class="btn btn-success"
                                      href="<?php echo $this->url('', array('controller' => 'invoice', 'action' => 'add', 'order' => $order['id'])); ?>"
                                      title="<?php _e('New invoice'); ?>"><i class="fa fa-plus"></i> <?php _e('New invoice'); ?></a></p>
                            </div>
                        <?php } ?>

                    </div>
                </div>
            </div>

            <!-- accordion -->
            <div class="panel <?php if (!empty($order['user_note'])) { ?>panel-info<?php } else { ?>panel-default<?php } ?>">
                <div class="panel-heading" role="tab" id="headingNote">
                    <h4 class="panel-title">
                        <a class="accordion-toggle" data-toggle="collapse" href="#collapseNote" aria-expanded="false" aria-controls="collapseNote">
                            <i class="fa fa-plus"></i> <?php _e('Note'); ?>
                        </a>
                    </h4>
                </div>
                <div id="collapseNote" class="panel-collapse collapse <?php if (!empty($order['user_note'])) { ?>in<?php } ?>" role="tabpanel" aria-labelledby="headingNote">
                    <div class="panel-body">
                        <?php if (!empty($order['user_note'])) { ?>
                            <div class="clearfix">
                                <h4><?php _e('User note'); ?></h4>
                                <div class="clearfix">
                                    <?php echo $order['user_note']; ?>
                                </div>
                                <hr />
                            </div>
                        <?php } ?>
                        <div class="clearfix">
                            <h4><?php _e('Admin note'); ?></h4>
                            <div id="update-note-<?php echo $this->escape($order['id']); ?>" class="clearfix">
                                <?php echo $order['admin_note']; ?>
                            </div>
                            <hr />
                            <ul class="list-inline clearfix">
                                <li class="pull-left"><?php _e('You can set any note for user'); ?></li>
                                <li class="pull-right">
                                    <a class="pull-right update-note btn btn-success">
                                        <i class="fa fa-plus"></i> <?php _e('Add / edit admin note'); ?>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- accordion -->
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="headingUser">
                    <h4 class="panel-title">
                        <a class="accordion-toggle" data-toggle="collapse" href="#collapseUser" aria-expanded="false" aria-controls="collapseUser">
                            <i class="fa fa-plus"></i> <?php _e('User'); ?>
                        </a>
                    </h4>
                </div>
                <div id="collapseUser" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingUser">
                    <div class="panel-body">
                        <ul class="clearfix list-unstyled">
                            <li class="col-md-3"><strong><?php _e('ID'); ?></strong>
                                : <?php echo $this->escape($order['user']['id']); ?></li>
                            <li class="col-md-3"><strong><?php _e('Email'); ?></strong>
                                : <?php echo $this->escape($order['user']['email']); ?></li>
                            <li class="col-md-3"><strong><?php _e('Identity'); ?></strong>
                                : <?php echo $this->escape($order['user']['identity']); ?></li>
                            <li class="col-md-3"><strong><?php _e('Name'); ?></strong>
                                : <?php echo $this->escape($order['user']['name']); ?></li>
                        </ul>
                        <hr />
                        <ul class="list-inline clearfix">
                            <li class="pull-left"><?php _e('You can view / edit full user information'); ?></li>
                            <li class="pull-right">
                                <a class="btn btn-success" title="<?php _e('User information'); ?>" href="<?php echo $this->url('admin', array(
                                    'module' => 'user',
                                    'controller' => 'edit',
                                    'action' => 'index',
                                    'uid' => $credit['uid'],
                                )); ?>" target="_blank"><i class="fa fa-user"></i> <?php _e('User information'); ?></a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- accordion -->
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="headingPrice">
                    <h4 class="panel-title">
                        <a class="accordion-toggle" data-toggle="collapse" href="#collapsePrice" aria-expanded="false" aria-controls="collapsePrice">
                            <i class="fa fa-plus"></i> <?php _e('Price'); ?>
                        </a>
                    </h4>
                </div>
                <div id="collapsePrice" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingPrice">
                    <div class="panel-body">
                        <ul class="clearfix list-unstyled">
                            <li class="col-md-4"><strong><?php _e('Price'); ?></strong>
                                : <?php echo $this->escape($order['product_price_view']); ?></li>
                            <li class="col-md-4"><strong><?php _e('Discount'); ?></strong>
                                : <?php echo $this->escape($order['discount_price_view']); ?></li>
                            <li class="col-md-4"><strong><?php _e('Shipping'); ?></strong>
                                : <?php echo $this->escape($order['shipping_price_view']); ?></li>
                            <li class="col-md-4"><strong><?php _e('Packing'); ?></strong>
                                : <?php echo $this->escape($order['packing_price_view']); ?></li>
                            <li class="col-md-4"><strong><?php _e('Total'); ?></strong>
                                : <?php echo $this->escape($order['total_price_view']); ?></li>
                            <li class="col-md-4"><strong><?php _e('Paid'); ?></strong>
                                : <?php echo $this->escape($order['paid_price_view']); ?></li>
                            <?php if ($order['type_payment'] == 'installment') { ?>
                                <li class="col-md-4"><strong><?php _e('Installment numbers'); ?></strong>
                                    : <?php echo _number(count($order['invoices']) - 1); ?></li>
                            <?php } ?>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- accordion -->
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="headingOrder">
                    <h4 class="panel-title">
                        <a class="accordion-toggle" data-toggle="collapse" href="#collapseOrder" aria-expanded="false" aria-controls="collapseOrder">
                            <i class="fa fa-plus"></i> <?php _e('Order'); ?>
                        </a>
                    </h4>
                </div>
                <div id="collapseOrder" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOrder">
                    <div class="panel-body">
                        <ul class="clearfix list-unstyled">
                            <li class="col-md-4"><strong><?php _e('Status'); ?></strong> : <span
                                        id="update-order-<?php echo $this->escape($order['id']); ?>"
                                        class="update-order btn <?php echo $this->escape($order['orderClass']); ?> btn-xs"><?php echo $this->escape($order['orderTitle']); ?></span>
                            </li>
                            <li class="col-md-4"><strong><?php _e('Time'); ?></strong>
                                : <?php echo $this->escape($order['time_create_view']); ?></li>
                            <li class="col-md-4"><strong><?php _e('Finish'); ?></strong> : <span
                                        id="update-order-<?php echo $this->escape($order['id']); ?>-time"><?php echo $this->escape($order['time_finish_view']); ?></span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- accordion -->
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="headingPayment">
                    <h4 class="panel-title">
                        <a class="accordion-toggle" data-toggle="collapse" href="#collapsePayment" aria-expanded="false" aria-controls="collapsePayment">
                            <i class="fa fa-plus"></i> <?php _e('Payment'); ?>
                        </a>
                    </h4>
                </div>
                <div id="collapsePayment" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingPayment">
                    <div class="panel-body">
                        <ul class="clearfix list-unstyled">
                            <li class="col-md-3"><strong><?php _e('Status'); ?></strong> : <span
                                        id="update-payment-<?php echo $this->escape($order['id']); ?>"
                                        class="update-payment btn <?php echo $this->escape($order['paymentClass']); ?> btn-xs"><?php echo $this->escape($order['paymentTitle']); ?></span>
                            </li>
                            <li class="col-md-3"><strong><?php _e('Can pay?'); ?></strong> : <span
                                        id="update-canPay-<?php echo $this->escape($order['id']); ?>"
                                        class="update-canPay btn <?php echo $this->escape($order['canPayClass']); ?> btn-xs"><?php echo $this->escape($order['canPayTitle']); ?></span>
                            </li>
                            <li class="col-md-3"><strong><?php _e('Time'); ?></strong>
                                : <?php echo $this->escape($order['time_payment_view']); ?></li>
                            <li class="col-md-3"><strong><?php _e('Adapter'); ?></strong> : <span
                                        id="update-payment-<?php echo $this->escape($order['id']); ?>-adapter"><?php echo $this->escape($order['gateway']); ?></span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- accordion -->
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="headingDelivery">
                    <h4 class="panel-title">
                        <a class="accordion-toggle" data-toggle="collapse" href="#collapseDelivery" aria-expanded="false" aria-controls="collapseDelivery">
                            <i class="fa fa-plus"></i> <?php _e('Delivery'); ?>
                        </a>
                    </h4>
                </div>

                <div id="collapseDelivery" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingDelivery">
                    <div class="panel-body">
                        <ul class="clearfix list-unstyled">
                            <li class="col-md-3"><strong><?php _e('Status'); ?></strong> : <span
                                        id="update-delivery-<?php echo $this->escape($order['id']); ?>"
                                        class="update-delivery btn <?php echo $this->escape($order['deliveryClass']); ?> btn-xs"><?php echo $this->escape($order['deliveryTitle']); ?></span>
                            </li>
                            <li class="col-md-3"><strong><?php _e('Time'); ?></strong> : <span
                                        id="update-delivery-<?php echo $this->escape($order['id']); ?>-time"><?php echo $this->escape($order['time_delivery_view']); ?></span>
                            </li>
                            <li class="col-md-3"><strong><?php _e('Method'); ?></strong> :</li>
                            <li class="col-md-3"><strong><?php _e('Packing'); ?></strong> :</li>
                        </ul>
                    </div>
                </div>
            </div>

        </div>
    </div>
    <?php if ($order['type_payment'] == 'installment') { ?>
        <div class="clearfix">
            <div class="col-md-12 text-right">
                <a class="btn btn-success btn-lg" title="<?php _e('Print'); ?>"
                   href="<?php echo $this->url('', array('controller' => 'order', 'action' => 'print', 'id' => $order['id'])); ?>"><i
                            class="fa fa-print"></i> <?php _e('Print'); ?></a>
            </div>
        </div>
    <?php } ?>
</div>
<script>
    (function ($) {
        var page = {
            el: $('#js-order'),
            modal: $('<div class="modal fade">').appendTo(document.body),
            $: function (selector) {
                return this.el.find(selector);
            },
            init: function () {
                _.bindAll(this);
                this.$('.update-order').click(this.orderAction);
                this.$('.update-payment').click(this.paymentAction);
                this.$('.update-delivery').click(this.deliveryAction);
                this.$('.update-canPay').click(this.canPayAction);
                this.$('.update-note').click(this.noteAction);
            },
            orderAction: function (e) {
                var p = $(e.target).parents('div.order-form'),
                    self = this;
                $.get(p.attr('data-order')).done(function (res) {
                    self.modal.html(res).modal('show');
                    formModule.success = function (res) {
                        var d = res.data;
                        self.modal.html(res).modal('hide');
                        $('#update-order-' + p.attr('data-id')).attr('class', 'update-order btn ' + d.orderClass).html(d.orderTitle);
                        $('#update-order-' + p.attr('data-id') + '-time').html(d.time_finish_view);
                    };
                });
            },
            paymentAction: function (e) {
                var p = $(e.target).parents('div.order-form'),
                    self = this;
                $.get(p.attr('data-payment')).done(function (res) {
                    self.modal.html(res).modal('show');
                    formModule.success = function (res) {
                        var d = res.data;
                        self.modal.html(res).modal('hide');
                        $('#update-payment-' + p.attr('data-id')).attr('class', 'update-payment btn ' + d.paymentClass).html(d.paymentTitle);
                        $('#update-payment-' + p.attr('data-id') + '-adapter').html(d.payment_adapter);
                        $('#update-payment-' + p.attr('data-id') + '-method').html(d.payment_method);
                        $('#update-payment-' + p.attr('data-id') + '-time').html(d.time_payment_view);
                    };
                });
            },
            deliveryAction: function (e) {
                var p = $(e.target).parents('div.order-form'),
                    self = this;
                $.get(p.attr('data-delivery')).done(function (res) {
                    self.modal.html(res).modal('show');
                    formModule.success = function (res) {
                        var d = res.data;
                        self.modal.html(res).modal('hide');
                        $('#update-delivery-' + p.attr('data-id')).attr('class', 'update-delivery btn ' + d.deliveryClass).html(d.deliveryTitle);
                        $('#update-delivery-' + p.attr('data-id') + '-time').html(d.time_delivery_view);
                    };
                });
            },
            canPayAction: function (e) {
                var p = $(e.target).parents('div.order-form'),
                    self = this;
                $.get(p.attr('data-canPay')).done(function (res) {
                    self.modal.html(res).modal('show');
                    formModule.success = function (res) {
                        var d = res.data;
                        self.modal.html(res).modal('hide');
                        $('#update-canPay-' + p.attr('data-id')).attr('class', 'update-canPay btn ' + d.canPayClass).html(d.canPayTitle);
                    };
                });
            },
            noteAction: function (e) {
                var p = $(e.target).parents('div.order-form'),
                    self = this;
                $.get(p.attr('data-note')).done(function (res) {
                    self.modal.html(res).modal('show');
                    formModule.success = function (res) {
                        var d = res.data;
                        self.modal.html(res).modal('hide');
                        $('#update-note-' + p.attr('data-id')).attr('class', 'clearfix').html(d.admin_note);
                    };
                });
            },
        }
        page.init();
    })(jQuery)
</script>